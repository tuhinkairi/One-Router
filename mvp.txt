# Complete System Architecture - Unified API Gateway
## The Full Picture: Every Component, Every Connection

---

## ğŸ—ï¸ ARCHITECTURE OVERVIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         END USER DEVELOPERS                              â”‚
â”‚  (Companies using your platform to integrate Razorpay, PayPal, etc.)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                          â”‚
                    â–¼                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   YOUR WEB APP     â”‚    â”‚   THEIR CODE       â”‚
        â”‚   (Dashboard)      â”‚    â”‚   (Using SDK)      â”‚
        â”‚   Next.js 15       â”‚    â”‚   Python/JS/Go     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                          â”‚
                  â”‚  HTTPS                   â”‚  HTTPS
                  â”‚                          â”‚
                  â–¼                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          YOUR API GATEWAY (Backend)              â”‚
        â”‚              FastAPI (Python)                    â”‚
        â”‚                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Authentication Layer (Clerk)            â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Verify JWT tokens                    â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Validate API keys                    â”‚   â”‚
        â”‚  â”‚  â””â”€ Rate limiting checks                 â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Business Logic Layer                    â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Parse .env files                     â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Encrypt/decrypt credentials          â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Generate API keys                    â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Route requests to providers          â”‚   â”‚
        â”‚  â”‚  â””â”€ Transform requests/responses         â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Service Adapters                        â”‚   â”‚
        â”‚  â”‚  â”œâ”€ RazorpayAdapter                      â”‚   â”‚
        â”‚  â”‚  â”œâ”€ PayPalAdapter                        â”‚   â”‚
        â”‚  â”‚  â”œâ”€ TwilioAdapter                        â”‚   â”‚
        â”‚  â”‚  â””â”€ StripeAdapter                        â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚            â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   SUPABASE     â”‚    â”‚    â”‚      REDIS        â”‚
        â”‚  (PostgreSQL)  â”‚    â”‚    â”‚   (Cache/Queue)   â”‚
        â”‚                â”‚    â”‚    â”‚                   â”‚
        â”‚  Tables:       â”‚    â”‚    â”‚  Cache:           â”‚
        â”‚  - users       â”‚    â”‚    â”‚  - API keys       â”‚
        â”‚  - api_keys    â”‚    â”‚    â”‚  - Rate limits    â”‚
        â”‚  - credentials â”‚    â”‚    â”‚  - Config         â”‚
        â”‚  - logs        â”‚    â”‚    â”‚  - Sessions       â”‚
        â”‚  - webhooks    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   EXTERNAL APIs    â”‚
                    â”‚                    â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  Razorpay    â”‚ â”‚
                    â”‚  â”‚  API         â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚                    â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  PayPal      â”‚ â”‚
                    â”‚  â”‚  API         â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚                    â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  Twilio      â”‚ â”‚
                    â”‚  â”‚  API         â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DETAILED COMPONENT BREAKDOWN

### 1. FRONTEND LAYER (Next.js 15)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NEXT.JS 15 APP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  PUBLIC PAGES (No Auth Required)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /                Landing page                  â”‚    â”‚
â”‚  â”‚  /pricing         Pricing tiers                 â”‚    â”‚
â”‚  â”‚  /docs            API documentation             â”‚    â”‚
â”‚  â”‚  /sign-in         Clerk sign in                 â”‚    â”‚
â”‚  â”‚  /sign-up         Clerk sign up                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  PROTECTED PAGES (Clerk Auth Required)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /onboarding      .env upload & parsing         â”‚    â”‚
â”‚  â”‚  /dashboard       Main dashboard                â”‚    â”‚
â”‚  â”‚  /api-keys        Manage API keys               â”‚    â”‚
â”‚  â”‚  /services        Configure services            â”‚    â”‚
â”‚  â”‚  /logs            Transaction logs              â”‚    â”‚
â”‚  â”‚  /webhooks        Webhook configuration         â”‚    â”‚
â”‚  â”‚  /analytics       Usage analytics               â”‚    â”‚
â”‚  â”‚  /settings        Account settings              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  COMPONENTS                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - EnvUploadWizard (onboarding)                 â”‚    â”‚
â”‚  â”‚  - ServiceCard (show configured services)       â”‚    â”‚
â”‚  â”‚  - ApiKeyManager (generate/rotate keys)         â”‚    â”‚
â”‚  â”‚  - TransactionTable (logs viewer)               â”‚    â”‚
â”‚  â”‚  - WebhookForm (webhook config)                 â”‚    â”‚
â”‚  â”‚  - UsageChart (analytics visualization)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  STATE MANAGEMENT                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - React Server Components (default in 15)      â”‚    â”‚
â”‚  â”‚  - Client Components (only for interactivity)   â”‚    â”‚
â”‚  â”‚  - Zustand/Context for global state             â”‚    â”‚
â”‚  â”‚  - SWR/TanStack Query for data fetching         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tech Stack:**
- **Framework:** Next.js 15 (App Router)
- **UI:** Tailwind CSS + shadcn/ui
- **Auth:** Clerk React SDK
- **Forms:** React Hook Form + Zod
- **HTTP Client:** Fetch API / Axios
- **Charts:** Recharts / Chart.js

---

### 2. BACKEND LAYER (FastAPI)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI BACKEND                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  MIDDLEWARE STACK (Request Pipeline)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. CORS Middleware                             â”‚    â”‚
â”‚  â”‚     â””â”€ Allow frontend origin                    â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  2. Authentication Middleware                   â”‚    â”‚
â”‚  â”‚     â”œâ”€ Verify Clerk JWT (for dashboard)        â”‚    â”‚
â”‚  â”‚     â””â”€ Verify API Key (for SDK calls)          â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  3. Rate Limiting Middleware                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ Check Redis for rate limit               â”‚    â”‚
â”‚  â”‚     â””â”€ Increment counter                        â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  4. Logging Middleware                          â”‚    â”‚
â”‚  â”‚     â”œâ”€ Log request details                      â”‚    â”‚
â”‚  â”‚     â””â”€ Measure response time                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  API ROUTES                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PUBLIC ROUTES                                   â”‚    â”‚
â”‚  â”‚  GET  /health                                    â”‚    â”‚
â”‚  â”‚  GET  /docs                                      â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  ONBOARDING ROUTES                               â”‚    â”‚
â”‚  â”‚  POST /api/onboarding/parse                     â”‚    â”‚
â”‚  â”‚  POST /api/onboarding/configure                 â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  USER MANAGEMENT ROUTES (Clerk Auth)            â”‚    â”‚
â”‚  â”‚  GET  /api/user/profile                         â”‚    â”‚
â”‚  â”‚  PUT  /api/user/profile                         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  API KEY ROUTES (Clerk Auth)                    â”‚    â”‚
â”‚  â”‚  GET  /api/keys                                 â”‚    â”‚
â”‚  â”‚  POST /api/keys                                 â”‚    â”‚
â”‚  â”‚  PUT  /api/keys/{id}/rotate                    â”‚    â”‚
â”‚  â”‚  DEL  /api/keys/{id}                           â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  SERVICE CONFIG ROUTES (Clerk Auth)             â”‚    â”‚
â”‚  â”‚  GET  /api/services                             â”‚    â”‚
â”‚  â”‚  POST /api/services/{service}/configure        â”‚    â”‚
â”‚  â”‚  PUT  /api/services/{service}/features         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  UNIFIED API ROUTES (API Key Auth)              â”‚    â”‚
â”‚  â”‚  POST /v1/payments/orders                      â”‚    â”‚
â”‚  â”‚  GET  /v1/payments/orders/{id}                 â”‚    â”‚
â”‚  â”‚  POST /v1/payments/refunds                     â”‚    â”‚
â”‚  â”‚  POST /v1/subscriptions                        â”‚    â”‚
â”‚  â”‚  POST /v1/payment-links                        â”‚    â”‚
â”‚  â”‚  POST /v1/payouts                              â”‚    â”‚
â”‚  â”‚  POST /v1/sms                                  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  WEBHOOK ROUTES (Public with signature)         â”‚    â”‚
â”‚  â”‚  POST /webhooks/razorpay                        â”‚    â”‚
â”‚  â”‚  POST /webhooks/paypal                          â”‚    â”‚
â”‚  â”‚  POST /webhooks/twilio                          â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  ANALYTICS ROUTES (Clerk Auth)                  â”‚    â”‚
â”‚  â”‚  GET  /api/analytics/overview                   â”‚    â”‚
â”‚  â”‚  GET  /api/analytics/logs                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  SERVICES (Business Logic)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  EnvParserService                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ parse_env_file()                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ detect_service()                            â”‚    â”‚
â”‚  â”‚  â””â”€ detect_features()                           â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  CredentialManager                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ encrypt_credentials()                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ decrypt_credentials()                       â”‚    â”‚
â”‚  â”‚  â””â”€ store_credentials()                         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  KeyGenerator                                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ generate_key()                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ hash_key()                                   â”‚    â”‚
â”‚  â”‚  â””â”€ validate_key()                               â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  FeatureRouter                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ route_request()                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ get_adapter()                                â”‚    â”‚
â”‚  â”‚  â””â”€ transform_response()                         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  RateLimiter                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ check_limit()                                â”‚    â”‚
â”‚  â”‚  â”œâ”€ increment_counter()                          â”‚    â”‚
â”‚  â”‚  â””â”€ get_remaining()                              â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  WebhookHandler                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ verify_signature()                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ process_event()                              â”‚    â”‚
â”‚  â”‚  â””â”€ forward_to_user()                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  ADAPTERS (Service Integrations)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  BaseAdapter (Abstract)                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ normalize_request()                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ normalize_response()                        â”‚    â”‚
â”‚  â”‚  â””â”€ handle_error()                               â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  RazorpayAdapter                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ create_order()                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ create_subscription()                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ create_payment_link()                        â”‚    â”‚
â”‚  â”‚  â””â”€ create_payout()                              â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  PayPalAdapter                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ create_order()                               â”‚    â”‚
â”‚  â”‚  â””â”€ create_subscription()                        â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  TwilioAdapter                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ send_sms()                                   â”‚    â”‚
â”‚  â”‚  â””â”€ make_call()                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tech Stack:**
- **Framework:** FastAPI 0.104+
- **Async:** asyncio + httpx
- **Auth:** Clerk Python SDK
- **Encryption:** cryptography (Fernet)
- **Validation:** Pydantic v2
- **ORM:** SQLAlchemy 2.0 (async)

---

### 3. DATABASE LAYER (Supabase/PostgreSQL)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SUPABASE (PostgreSQL 15)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  TABLES & RELATIONSHIPS                                  â”‚
â”‚                                                          â”‚
â”‚  users                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (PK)              UUID                       â”‚    â”‚
â”‚  â”‚ clerk_user_id        VARCHAR (unique)           â”‚    â”‚
â”‚  â”‚ email                VARCHAR                    â”‚    â”‚
â”‚  â”‚ full_name            VARCHAR                    â”‚    â”‚
â”‚  â”‚ company_name         VARCHAR                    â”‚    â”‚
â”‚  â”‚ plan_tier            VARCHAR (free/pro/ent)     â”‚    â”‚
â”‚  â”‚ is_active            BOOLEAN                    â”‚    â”‚
â”‚  â”‚ created_at           TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ updated_at           TIMESTAMP                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                                      â”‚
â”‚                   â”‚ 1:N                                  â”‚
â”‚                   â–¼                                      â”‚
â”‚  api_keys                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (PK)              UUID                       â”‚    â”‚
â”‚  â”‚ user_id (FK)         UUID â†’ users.id            â”‚    â”‚
â”‚  â”‚ key_hash             VARCHAR (unique)           â”‚    â”‚
â”‚  â”‚ key_name             VARCHAR                    â”‚    â”‚
â”‚  â”‚ key_prefix           VARCHAR (unf_test/live)    â”‚    â”‚
â”‚  â”‚ environment          VARCHAR (test/live)        â”‚    â”‚
â”‚  â”‚ is_active            BOOLEAN                    â”‚    â”‚
â”‚  â”‚ rate_limit_per_min   INTEGER                    â”‚    â”‚
â”‚  â”‚ rate_limit_per_day   INTEGER                    â”‚    â”‚
â”‚  â”‚ last_used_at         TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ expires_at           TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ created_at           TIMESTAMP                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                                      â”‚
â”‚                   â”‚ 1:N                                  â”‚
â”‚                   â–¼                                      â”‚
â”‚  service_credentials                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (PK)              UUID                       â”‚    â”‚
â”‚  â”‚ user_id (FK)         UUID â†’ users.id            â”‚    â”‚
â”‚  â”‚ service_name         VARCHAR (razorpay/paypal)  â”‚    â”‚
â”‚  â”‚ environment          VARCHAR (test/live)        â”‚    â”‚
â”‚  â”‚ credentials_encrypted TEXT (AES-256)            â”‚    â”‚
â”‚  â”‚ features_config      JSONB                      â”‚    â”‚
â”‚  â”‚   {                                             â”‚    â”‚
â”‚  â”‚     "payments": {"enabled": true},              â”‚    â”‚
â”‚  â”‚     "subscriptions": {"enabled": false}         â”‚    â”‚
â”‚  â”‚   }                                             â”‚    â”‚
â”‚  â”‚ webhook_secret       VARCHAR                    â”‚    â”‚
â”‚  â”‚ is_active            BOOLEAN                    â”‚    â”‚
â”‚  â”‚ last_verified_at     TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ created_at           TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ updated_at           TIMESTAMP                  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ UNIQUE(user_id, service_name, environment)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  transaction_logs                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (PK)              UUID                       â”‚    â”‚
â”‚  â”‚ user_id (FK)         UUID â†’ users.id            â”‚    â”‚
â”‚  â”‚ api_key_id (FK)      UUID â†’ api_keys.id         â”‚    â”‚
â”‚  â”‚ transaction_id       VARCHAR (unique)           â”‚    â”‚
â”‚  â”‚ service_name         VARCHAR                    â”‚    â”‚
â”‚  â”‚ provider_txn_id      VARCHAR                    â”‚    â”‚
â”‚  â”‚ endpoint             VARCHAR                    â”‚    â”‚
â”‚  â”‚ http_method          VARCHAR                    â”‚    â”‚
â”‚  â”‚ request_payload      JSONB                      â”‚    â”‚
â”‚  â”‚ response_payload     JSONB                      â”‚    â”‚
â”‚  â”‚ response_status      INTEGER                    â”‚    â”‚
â”‚  â”‚ response_time_ms     INTEGER                    â”‚    â”‚
â”‚  â”‚ status               VARCHAR (success/failed)   â”‚    â”‚
â”‚  â”‚ error_message        TEXT                       â”‚    â”‚
â”‚  â”‚ ip_address           INET                       â”‚    â”‚
â”‚  â”‚ user_agent           TEXT                       â”‚    â”‚
â”‚  â”‚ environment          VARCHAR                    â”‚    â”‚
â”‚  â”‚ created_at           TIMESTAMP                  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ INDEXES:                                         â”‚    â”‚
â”‚  â”‚ - idx_user_id_created                           â”‚    â”‚
â”‚  â”‚ - idx_transaction_id                            â”‚    â”‚
â”‚  â”‚ - idx_service_name                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  webhook_events                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (PK)              UUID                       â”‚    â”‚
â”‚  â”‚ user_id (FK)         UUID â†’ users.id            â”‚    â”‚
â”‚  â”‚ service_name         VARCHAR                    â”‚    â”‚
â”‚  â”‚ event_type           VARCHAR                    â”‚    â”‚
â”‚  â”‚ payload              JSONB                      â”‚    â”‚
â”‚  â”‚ signature            VARCHAR                    â”‚    â”‚
â”‚  â”‚ processed            BOOLEAN                    â”‚    â”‚
â”‚  â”‚ processed_at         TIMESTAMP                  â”‚    â”‚
â”‚  â”‚ related_txn_id (FK)  UUID â†’ transaction_logs.id â”‚    â”‚
â”‚  â”‚ created_at           TIMESTAMP                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  ROW LEVEL SECURITY (RLS)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ All tables have RLS enabled                     â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Policies:                                        â”‚    â”‚
â”‚  â”‚ - Users can only see their own data             â”‚    â”‚
â”‚  â”‚ - No cross-tenant data access                   â”‚    â”‚
â”‚  â”‚ - Enforced at database level                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. CACHE LAYER (Redis)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REDIS 7.0+                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  KEY PATTERNS & USE CASES                                â”‚
â”‚                                                          â”‚
â”‚  1. RATE LIMITING                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: ratelimit:{api_key_id}:minute              â”‚    â”‚
â”‚  â”‚ Type: Sorted Set (ZSET)                         â”‚    â”‚
â”‚  â”‚ TTL: 60 seconds                                  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Usage:                                           â”‚    â”‚
â”‚  â”‚ - Track requests per minute per API key         â”‚    â”‚
â”‚  â”‚ - Sliding window algorithm                       â”‚    â”‚
â”‚  â”‚ - Return 429 if limit exceeded                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  2. SESSION CACHE                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: session:{clerk_user_id}                    â”‚    â”‚
â”‚  â”‚ Type: String (JSON)                              â”‚    â”‚
â”‚  â”‚ TTL: 3600 seconds (1 hour)                       â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Cached Data:                                     â”‚    â”‚
â”‚  â”‚ - User profile                                   â”‚    â”‚
â”‚  â”‚ - Active API keys                                â”‚    â”‚
â”‚  â”‚ - Plan tier & limits                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  3. API KEY VALIDATION CACHE                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: apikey:{key_hash}                          â”‚    â”‚
â”‚  â”‚ Type: Hash                                       â”‚    â”‚
â”‚  â”‚ TTL: 300 seconds (5 minutes)                     â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Fields:                                          â”‚    â”‚
â”‚  â”‚ - user_id                                        â”‚    â”‚
â”‚  â”‚ - is_active                                      â”‚    â”‚
â”‚  â”‚ - environment                                    â”‚    â”‚
â”‚  â”‚ - rate_limit                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  4. SERVICE CREDENTIALS CACHE                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: creds:{user_id}:{service}:{env}            â”‚    â”‚
â”‚  â”‚ Type: String (encrypted JSON)                    â”‚    â”‚
â”‚  â”‚ TTL: 600 seconds (10 minutes)                    â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Cached Data:                                     â”‚    â”‚
â”‚  â”‚ - Encrypted service credentials                  â”‚    â”‚
â”‚  â”‚ - Feature configuration                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  5. IDEMPOTENCY KEYS                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: idempotent:{user_id}:{idempotency_key}     â”‚    â”‚
â”‚  â”‚ Type: String (response JSON)                     â”‚    â”‚
â”‚  â”‚ TTL: 86400 seconds (24 hours)                    â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Usage:                                           â”‚    â”‚
â”‚  â”‚ - Prevent duplicate payments                     â”‚    â”‚
â”‚  â”‚ - Return cached response for same request       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  6. WEBHOOK QUEUE                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: webhooks:{user_id}                         â”‚    â”‚
â”‚  â”‚ Type: Stream (XADD/XREAD)                        â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Usage:                                           â”‚    â”‚
â”‚  â”‚ - Queue incoming webhooks                        â”‚    â”‚
â”‚  â”‚ - Reliable async processing                      â”‚    â”‚
â”‚  â”‚ - Delivery tracking                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  7. USAGE ANALYTICS                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key: usage:{service}:daily                      â”‚    â”‚
â”‚  â”‚ Type: Sorted Set (leaderboard)                   â”‚    â”‚
â”‚  â”‚ TTL: 2592000 seconds (30 days)                   â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Usage:                                           â”‚    â”‚
â”‚  â”‚ - Track API calls per user                       â”‚    â”‚
â”‚  â”‚ - Generate usage reports                         â”‚    â”‚
â”‚  â”‚ - Billing calculations                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. AUTHENTICATION FLOW (Clerk)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  TWO AUTHENTICATION METHODS:                             â”‚
â”‚                                                          â”‚
â”‚  METHOD 1: Dashboard Users (Clerk JWT)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  User signs in with Clerk                       â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Clerk returns JWT token                        â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Frontend sends JWT in Authorization header     â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Backend validates JWT with Clerk SDK           â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Extract user_id from JWT claims                â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Proceed with request                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  METHOD 2: SDK Users (Platform API Key)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Developer uses SDK with API key                â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  SDK sends key in X-Platform-Key header         â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Backend hashes incoming key                    â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Check Redis cache for key                      â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Cache miss â†’ Query database                    â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Validate: is_active, not expired               â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Check rate limit in Redis                      â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Extract user_id from api_key record            â”‚    â”‚
â”‚  â”‚         â†“                                        â”‚    â”‚
â”‚  â”‚  Proceed with request                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. REQUEST FLOW (End-to-End)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          COMPLETE REQUEST FLOW (Payment Example)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  STEP 1: Developer Makes Request                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Python code:                                   â”‚    â”‚
â”‚  â”‚  ```python                                      â”‚    â”‚
â”‚  â”‚  client = UnifiedClient(api_key="unf_live_xyz") â”‚    â”‚
â”‚  â”‚  order = client.payments.create(                â”‚    â”‚
â”‚  â”‚      amount=500.00,                             â”‚    â”‚
â”‚  â”‚      currency="INR"                             â”‚    â”‚
â”‚  â”‚  )                                              â”‚    â”‚
â”‚  â”‚  ```                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 2: SDK Sends HTTP Request                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  POST /v1/payments/orders                       â”‚    â”‚
â”‚  â”‚  Headers:                                        â”‚    â”‚
â”‚  â”‚    X-Platform-Key: unf_live_xyz                 â”‚    â”‚
â”‚  â”‚    Content-Type: application/json               â”‚    â”‚
â”‚  â”‚  Body:                                           â”‚    â”‚
â”‚  â”‚    {"amount": 500.00, "currency": "INR"}        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 3: FastAPI Middleware Pipeline                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. Authenticate API key                        â”‚    â”‚
â”‚  â”‚     - Hash key                                   â”‚    â”‚
â”‚  â”‚     - Check Redis cache                          â”‚    â”‚
â”‚  â”‚     - Validate & get user_id                     â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  2. Rate Limiting                                â”‚    â”‚
â”‚  â”‚     - Check: ratelimit:{api_key_id}:minute      â”‚    â”‚
â”‚  â”‚     - If limit exceeded â†’ 429 error              â”‚    â”‚
â”‚  â”‚     - Else increment counter                     â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  3. Request Logging                              â”‚    â”‚
â”‚  â”‚     - Generate transaction_id                    â”‚    â”‚
â”‚  â”‚     - Log request start time                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 4: Business Logic                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. Get Service Credentials                     â”‚    â”‚
â”‚  â”‚     - Check Redis: creds:{user_id}:razorpay     â”‚    â”‚
â”‚  â”‚     - Cache miss â†’ Query database                â”‚    â”‚
â”‚  â”‚     - Decrypt credentials                        â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  2. Transform Request                            â”‚    â”‚
â”‚  â”‚     - Generic format â†’ Razorpay format          â”‚    â”‚
â”‚  â”‚     - amount: 500.00 â†’ 50000 (paise)            â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  3. Check Idempotency                            â”‚    â”‚
â”‚  â”‚     - Key: idempotent:{user_id}:{request_hash}  â”‚    â”‚
â”‚  â”‚     - If exists â†’ return cached response         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 5: Call External API (Razorpay)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  POST https://api.razorpay.com/v1/orders       â”‚    â”‚
â”‚  â”‚  Authorization: Basic {base64(key:secret)}      â”‚    â”‚
â”‚  â”‚  Body:                                           â”‚    â”‚
â”‚  â”‚    {                                             â”‚    â”‚
â”‚  â”‚      "amount": 50000,                           â”‚    â”‚
â”‚  â”‚      "currency": "INR",                         â”‚    â”‚
â”‚  â”‚      "receipt": "rcpt_123"                      â”‚    â”‚
â”‚  â”‚    }                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 6: Razorpay Response                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  {                                              â”‚    â”‚
â”‚  â”‚    "id": "order_abc123",                        â”‚    â”‚
â”‚  â”‚    "amount": 50000,                             â”‚    â”‚
â”‚  â”‚    "currency": "INR",                           â”‚    â”‚
â”‚  â”‚    "status": "created",                         â”‚    â”‚
â”‚  â”‚    "created_at": 1234567890                     â”‚    â”‚
â”‚  â”‚  }                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 7: Transform & Log                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. Transform Response                           â”‚    â”‚
â”‚  â”‚     - Razorpay format â†’ Generic format          â”‚    â”‚
â”‚  â”‚     - Add transaction_id                         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  2. Save to Database                             â”‚    â”‚
â”‚  â”‚     - transaction_logs table                     â”‚    â”‚
â”‚  â”‚     - Store request + response                   â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  3. Cache Response                               â”‚    â”‚
â”‚  â”‚     - Store in Redis for idempotency             â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  4. Update Usage Stats                           â”‚    â”‚
â”‚  â”‚     - Increment usage counter                    â”‚    â”‚
â”‚  â”‚     - Track cost                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  STEP 8: Return to Developer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  {                                              â”‚    â”‚
â”‚  â”‚    "transaction_id": "txn_xyz789",              â”‚    â”‚
â”‚  â”‚    "provider": "razorpay",                      â”‚    â”‚
â”‚  â”‚    "provider_order_id": "order_abc123",         â”‚    â”‚
â”‚  â”‚    "amount": 500.00,                            â”‚    â”‚
â”‚  â”‚    "currency": "INR",                           â”‚    â”‚
â”‚  â”‚    "status": "created",                         â”‚    â”‚
â”‚  â”‚    "created_at": "2025-01-01T00:00:00Z"         â”‚    â”‚
â”‚  â”‚  }                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  Total Time: ~200-500ms                                  â”‚
â”‚  - API key validation (Redis): 1-2ms                     â”‚
â”‚  - Rate limit check (Redis): 1-2ms                       â”‚
â”‚  - Get credentials (Redis/DB): 5-10ms                    â”‚
â”‚  - Razorpay API call: 150-400ms                          â”‚
â”‚  - Database logging: 10-20ms                             â”‚
â”‚  - Response transformation: 1-2ms                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7. SDK ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  YOUR SDK (Developer Side)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  LANGUAGES: Python, JavaScript/TypeScript, Go           â”‚
â”‚                                                          â”‚
â”‚  PYTHON SDK STRUCTURE                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  unified_sdk/                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ __init__.py                                â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ client.py          (Main client)           â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ http_client.py     (HTTP wrapper)          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ resources/                                 â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ payments.py                            â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ subscriptions.py                       â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ payment_links.py                       â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ payouts.py                             â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ sms.py                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ exceptions.py      (Custom exceptions)     â”‚    â”‚
â”‚  â”‚  â””â”€â”€ utils.py           (Helper functions)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  FEATURES                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âœ… Automatic retry with exponential backoff    â”‚    â”‚
â”‚  â”‚  âœ… Built-in idempotency key generation         â”‚    â”‚
â”‚  â”‚  âœ… Timeout configuration                        â”‚    â”‚
â”‚  â”‚  âœ… Error handling & custom exceptions          â”‚    â”‚
â”‚  â”‚  âœ… Request/response logging (optional)         â”‚    â”‚
â”‚  â”‚  âœ… Type hints & autocomplete                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  USAGE EXAMPLE                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  from unified_sdk import UnifiedClient          â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  client = UnifiedClient(                        â”‚    â”‚
â”‚  â”‚      api_key="unf_live_xyz",                    â”‚    â”‚
â”‚  â”‚      timeout=30,                                 â”‚    â”‚
â”‚  â”‚      max_retries=3                               â”‚    â”‚
â”‚  â”‚  )                                              â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  # Create payment                                â”‚    â”‚
â”‚  â”‚  order = client.payments.create(                â”‚    â”‚
â”‚  â”‚      amount=500.00,                             â”‚    â”‚
â”‚  â”‚      currency="INR",                            â”‚    â”‚
â”‚  â”‚      customer_email="user@example.com"          â”‚    â”‚
â”‚  â”‚  )                                              â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  # Create subscription                           â”‚    â”‚
â”‚  â”‚  sub = client.subscriptions.create(             â”‚    â”‚
â”‚  â”‚      plan_id="plan_123",                        â”‚    â”‚
â”‚  â”‚      customer_id="cust_456"                     â”‚    â”‚
â”‚  â”‚  )                                              â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚  # Send SMS                                      â”‚    â”‚
â”‚  â”‚  sms = client.sms.send(                         â”‚    â”‚
â”‚  â”‚      to="+919876543210",                        â”‚    â”‚
â”‚  â”‚      message="Your OTP is 123456"               â”‚    â”‚
â”‚  â”‚  )                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 8. DEPLOYMENT ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PRODUCTION DEPLOYMENT                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  FRONTEND (Next.js)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Platform: Vercel                               â”‚    â”‚
â”‚  â”‚  - Automatic deployments from Git               â”‚    â”‚
â”‚  â”‚  - Edge functions                                â”‚    â”‚
â”‚  â”‚  - CDN for static assets                         â”‚    â”‚
â”‚  â”‚  - Custom domain: app.yourplatform.com          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  BACKEND (FastAPI)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Platform: Railway / Render / AWS EC2           â”‚    â”‚
â”‚  â”‚  - Docker container                              â”‚    â”‚
â”‚  â”‚  - Auto-scaling (2-10 instances)                 â”‚    â”‚
â”‚  â”‚  - Health checks                                 â”‚    â”‚
â”‚  â”‚  - Custom domain: api.yourplatform.com          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  DATABASE (Supabase)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - Managed PostgreSQL 15                        â”‚    â”‚
â”‚  â”‚  - Automatic backups                             â”‚    â”‚
â”‚  â”‚  - Connection pooling                            â”‚    â”‚
â”‚  â”‚  - Row Level Security                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  CACHE (Redis)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Platform: Upstash / Redis Cloud                â”‚    â”‚
â”‚  â”‚  - Serverless Redis                              â”‚    â”‚
â”‚  â”‚  - Automatic persistence                         â”‚    â”‚
â”‚  â”‚  - High availability                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  MONITORING                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - Sentry (error tracking)                      â”‚    â”‚
â”‚  â”‚  - Datadog / New Relic (APM)                     â”‚    â”‚
â”‚  â”‚  - Uptime monitoring (Better Uptime)             â”‚    â”‚
â”‚  â”‚  - Log aggregation (Papertrail)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  CI/CD                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  GitHub Actions:                                 â”‚    â”‚
â”‚  â”‚  - Run tests on PR                               â”‚    â”‚
â”‚  â”‚  - Deploy to staging                             â”‚    â”‚
â”‚  â”‚  - Deploy to production (on merge to main)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” SECURITY LAYERS

```
1. TRANSPORT SECURITY
   â””â”€ TLS 1.3 (HTTPS only)

2. AUTHENTICATION
   â”œâ”€ Clerk JWT for dashboard users
   â””â”€ Hashed API keys for SDK users

3. AUTHORIZATION
   â”œâ”€ Row Level Security (PostgreSQL)
   â””â”€ API key scoping per user

4. DATA ENCRYPTION
   â”œâ”€ Credentials encrypted at rest (AES-256)
   â”œâ”€ TLS for data in transit
   â””â”€ Encrypted backups

5. RATE LIMITING
   â”œâ”€ Per API key
   â”œâ”€ Per endpoint
   â””â”€ Per IP address

6. INPUT VALIDATION
   â”œâ”€ Pydantic models (backend)
   â””â”€ Zod schemas (frontend)

7. SECRETS MANAGEMENT
   â”œâ”€ Environment variables
   â””â”€ Never log sensitive data

8. AUDIT LOGGING
   â”œâ”€ All transactions logged
   â””â”€ Immutable audit trail
```

---

## ğŸ“Š TECH STACK SUMMARY

| Layer | Technology | Why |
|-------|-----------|-----|
| **Frontend** | Next.js 15 | Server Components, best DX |
| **Backend** | FastAPI | Async, fast, Python ecosystem |
| **Database** | Supabase/PostgreSQL | RLS, realtime, managed |
| **Cache** | Redis | Speed, pub/sub, queues |
| **Auth** | Clerk | Enterprise ready, webhooks |
| **Encryption** | Fernet (AES-256) | Standard, proven |
| **Deploy** | Vercel + Railway | Easy, auto-scaling |
| **Monitoring** | Sentry + Datadog | Error tracking + APM |

---

## ğŸ¯ SUMMARY

This is a **multi-tenant SaaS platform** with:

âœ… **User onboarding** - Upload .env, auto-detect services  
âœ… **Credential management** - Encrypted storage  
âœ… **API gateway** - Route to Razorpay/PayPal/Twilio  
âœ… **SDK** - Single interface for developers  
âœ… **Dashboard** - Manage everything  
âœ… **Analytics** - Usage tracking  
âœ… **Webhooks** - Real-time events  
âœ… **Rate limiting** - Prevent abuse  
âœ… **Security** - Enterprise-grade  

**Scale:** Can handle 1M+ API calls/day with proper infrastructure!